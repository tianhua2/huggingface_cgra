# ุงูุชุฏุฑูุจ ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ tensor (TPU) ุจุงุณุชุฎุฏุงู TensorFlow

<Tip>

ุฅุฐุง ููุช ูุง ุชุญุชุงุฌ ุฅูู ุชูุณูุฑุงุช ูุทููุฉ ูุชุฑูุฏ ููุท ุงูุงุทูุงุน ุนูู ุฃูุซูุฉ ูู ุฃููุงุฏ TPU ูุชุจุฏุฃ ุจูุงุ ููููู ุงูุงุทูุงุน ุนูู [ุฏูุชุฑ ุงูููุงุญุธุงุช ุงูุฎุงุต ุจูุง ุญูู ูุซุงู TPU](https://colab.research.google.com/github.com/huggingface/notebooks/blob/main/examples/tpu_training-tf.ipynb)

</Tip>

### ูุง ูู ูุญุฏุฉ ูุนุงูุฌุฉ tensor (TPU)ุ

ูุญุฏุฉ ูุนุงูุฌุฉ tensor (TPU) ูู **ูุญุฏุฉ ูุนุงูุฌุฉ tensor**ุ ููู ุนุจุงุฑุฉ ุนู ุฃุฌูุฒุฉ ูุตููุฉ ูู ูุจู Google ูุชุณุชุฎุฏู ูุชุณุฑูุน ุนูููุงุช ุงูุญุณุงุจ ุฏุงุฎู ุงูุดุจูุงุช ุงูุนุตุจูุฉุ ุชูุงููุง ูุซู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (GPUs). ูููู ุงุณุชุฎุฏุงููุง ููู ูู ุชุฏุฑูุจ ุงูุดุจูุฉ ูุงูุงุณุชุฏูุงู. ูุชู ุงููุตูู ุฅูููุง ุจุดูู ุนุงู ูู ุฎูุงู ุฎุฏูุงุช ุงูุญูุณุจุฉ ุงูุณุญุงุจูุฉ ุงูุฎุงุตุฉ ุจู Googleุ ูููู ูููู ุฃูุถูุง ุงููุตูู ุฅูู ูุญุฏุงุช TPU ุงูุตุบูุฑุฉ ูุจุงุดุฑุฉ ููุฌุงููุง ุนุจุฑ Google Colab ูKaggle Kernels.

ูุธุฑูุง ูุฃู [ุฌููุน ููุงุฐุฌ TensorFlow ูู ููุชุจุฉ ๐ค Transformers ูู ููุงุฐุฌ Keras](https://huggingface.co/blog/tensorflow-philosophy)ุ ูุฅู ูุนุธู ุงูุทุฑู ูู ูุฐู ุงููุซููุฉ ุชูุทุจู ุจุดูู ุนุงู ุนูู ุงูุชุฏุฑูุจ ุนูู ูุญุฏุฉ TPU ูุฃู ูููุฐุฌ Keras! ููุน ุฐููุ ููุงู ุจุนุถ ุงูููุงุท ุงููุญุฏุฏุฉ ุงูุฎุงุตุฉ ุจูุธุงู HuggingFace (hug-o-systemุ) ููููุงุฐุฌ ูุงููุฌููุนุงุชุ ูุณูุญุฑุต ุนูู ุงูุฅุดุงุฑุฉ ุฅูููุง ุนูุฏ ุงููุตูู ุฅูููุง.

### ูุง ูู ุฃููุงุน ูุญุฏุงุช TPU ุงููุชุงุญุฉุ

ุบุงูุจูุง ูุง ูููู ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ ูุญุชุงุฑูู ุฌุฏูุง ุจุณุจุจ ูุทุงู ูุญุฏุงุช TPUุ ูุงูุทุฑู ุงููุฎุชููุฉ ูููุตูู ุฅูููุง. ุฃูู ุชูููุฒ ุฑุฆูุณู ูุฌุจ ูููู ูู ุงููุฑู ุจูู **ุนูุฏ TPU** ู**ุขูุงุช TPU ุงูุงูุชุฑุงุถูุฉ (VMs)**.

ุนูุฏูุง ุชุณุชุฎุฏู **ุนูุฏุฉ TPU**ุ ูุฃูุช ุจุดูู ูุนุงู ุชููู ุจุงููุตูู ุบูุฑ ุงููุจุงุดุฑ ุฅูู ูุญุฏุฉ TPU ุนู ุจุนุฏ. ุณุชุญุชุงุฌ ุฅูู ุขูุฉ ุงูุชุฑุงุถูุฉ ูููุตูุฉุ ูุงูุชู ุณุชููู ุจุชููุฆุฉ ุดุจูุชู ูุฎุท ุฃูุงุจูุจ ุจูุงูุงุชู ููู ุซู ุฅุฑุณุงููุง ุฅูู ุงูุนูุฏุฉ ุงูุจุนูุฏุฉ. ุนูุฏูุง ุชุณุชุฎุฏู ูุญุฏุฉ TPU ุนูู Google Colabุ ูุฃูุช ุชููู ุจุงููุตูู ุฅูููุง ุนูู ุทุฑููุฉ **ุนูุฏุฉ TPU**.

ูููู ุฃู ูููู ูุงุณุชุฎุฏุงู ุนูุฏ TPU ุจุนุถ ุงูุณููููุงุช ุบูุฑ ุงููุชููุนุฉ ููุบุงูุฉ ุจุงููุณุจุฉ ููุฃุดุฎุงุต ุงูุฐูู ูู ูุนุชุงุฏูุง ุนูููุง! ุนูู ูุฌู ุงูุฎุตูุตุ ูุธุฑูุง ูุฃู ูุญุฏุฉ TPU ุชูุน ุนูู ูุธุงู ูุฎุชูู ูุนูููุง ุนู ุงูุฌูุงุฒ ุงูุฐู ุชุดุบู ุนููู ููุฏ Python ุงูุฎุงุต ุจูุ ูุง ูููู ุฃู ุชููู ุจูุงูุงุชู ูุญููุฉ ุนูู ุฌูุงุฒู - ุณูุคุฏู ุฃู ุฎุท ุฃูุงุจูุจ ููุจูุงูุงุช ูุญูู ูู ุงูุชุฎุฒูู ุงูุฏุงุฎูู ูุฌูุงุฒู ุฅูู ุงููุดู ุงูุชุงู! ุจุฏูุงู ูู ุฐููุ ูุฌุจ ุชุฎุฒูู ุงูุจูุงูุงุช ูู Google Cloud Storage ุญูุซ ูููู ูุฎุท ุฃูุงุจูุจ ุงูุจูุงูุงุช ุงููุตูู ุฅูููุงุ ุญุชู ุนูุฏูุง ูุนูู ุงูุฎุท ุนูู ุนูุฏุฉ TPU ุงูุจุนูุฏุฉ.

<Tip>

ุฅุฐุง ูุงู ุจุฅููุงูู ูุถุน ุฌููุน ุจูุงูุงุชู ูู ุงูุฐุงูุฑุฉ ูู `np.ndarray` ุฃู `tf.Tensor`ุ ูููููู ุญููุฆุฐู ุชุดุบูู `fit()` ุนูู ุชูู ุงูุจูุงูุงุช ุญุชู ุนูุฏ ุงุณุชุฎุฏุงู Colab ุฃู ุนูุฏุฉ TPUุ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชุญููููุง ุฅูู Google Cloud Storage.

</Tip>

<Tip>

**๐คูุตูุญุฉ ุฎุงุตุฉ ุจู Hugging Face๐ค:** ุณุชุคุฏู ูู ูู ุทุฑููุชู `Dataset.to_tf_dataset()` ูุบูุงููุง ุนุงูู ุงููุณุชูู `model.prepare_tf_dataset()`ุ ูุงูุชู ุณุชุฑุงูุง ูู ุฌููุน ุฃูุซูุฉ ููุฏ TF ูุฏููุงุ ุฅูู ุงููุดู ุนูู ุนูุฏุฉ TPU. ูุงูุณุจุจ ูู ุฐูู ูู ุฃูู ุนูู ุงูุฑุบู ูู ุฃูููุง ุชูุดุฆุงู `tf.data.Dataset`ุ ุฅูุง ุฃูููุง ูุง ุชูุดุฆุงู ุฎุท ุฃูุงุจูุจ "ุฎุงูุต" `tf.data` ููุณุชุฎุฏูุงู `tf.numpy_function` ุฃู `Dataset.from_generator()` ูุฏูู ุงูุจูุงูุงุช ูู ูุฌููุนุฉ HuggingFace ุงูุฃุณุงุณูุฉ. ูุฐู ุงููุฌููุนุฉ ุงูุฃุณุงุณูุฉ HuggingFace ูุฏุนููุฉ ุจุจูุงูุงุช ููุฌูุฏุฉ ุนูู ูุฑุต ูุญูู ููุง ูููู ูุนูุฏุฉ TPU ุงูุจุนูุฏุฉ ูุฑุงุกุชูุง.

</Tip>

ุงูุทุฑููุฉ ุงูุซุงููุฉ ูููุตูู ุฅูู ูุญุฏุฉ TPU ูู ุนุจุฑ **ุขูุฉ TPU ุงูุงูุชุฑุงุถูุฉ (VM)**. ุนูุฏ ุงุณุชุฎุฏุงู ุขูุฉ TPU ุงูุงูุชุฑุงุถูุฉุ ูุฃูุช ุชุชุตู ูุจุงุดุฑุฉ ุจุงูุฌูุงุฒ ุงูุฐู ุชุชุตู ุจู ูุญุฏุฉ TPUุ ุชูุงููุง ูุซู ุงูุชุฏุฑูุจ ุนูู ุขูุฉ GPU ุงูุชุฑุงุถูุฉ. ุชุนุฏ ุขูุงุช TPU ุงูุงูุชุฑุงุถูุฉ ุฃุณูู ุนููููุง ูู ุงูุนูู ูุนูุงุ ุฎุงุตุฉ ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจุฎุท ุฃูุงุจูุจ ุจูุงูุงุชู. ูุง ุชูุทุจู ุฌููุน ุงูุชุญุฐูุฑุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุนูู ุขูุงุช TPU ุงูุงูุชุฑุงุถูุฉ!

ูุฐู ูุซููุฉ ุฐุงุช ุฑุฃูุ ูุฐุง ุฅููู ุฑุฃููุง: **ุชุฌูุจ ุงุณุชุฎุฏุงู ุนูุฏุฉ TPU ุฅุฐุง ุฃููู ุฐูู.** ููู ุฃูุซุฑ ุชุนููุฏูุง ูุตุนูุจุฉ ูู ุงูุชุตุญูุญ ูู ุขูุงุช TPU ุงูุงูุชุฑุงุถูุฉ. ููู ุงููุญุชูู ุฃูุถูุง ุฃูุง ูุชู ุฏุนูู ูู ุงููุณุชูุจู - ูุง ูููู ุงููุตูู ุฅูู ุฃุญุฏุซ ูุญุฏุฉ TPU ูู Googleุ ููู TPUv4ุ ุฅูุง ูุขูุฉ TPU ุงูุชุฑุงุถูุฉุ ููุง ูุดูุฑ ุฅูู ุฃู ุนูุฏ TPU ุณุชุตุจุญ ุจุดูู ูุชุฒุงูุฏ ุทุฑููุฉ ูุตูู "ุชุฑุงุซูุฉ". ููุน ุฐููุ ูุฏุฑู ุฃู ุงููุตูู ุงููุฌุงูู ุงููุญูุฏ ููุญุฏุฉ TPU ูู ุนุจุฑ Colab ูKaggle Kernelsุ ูุงูุชู ุชุณุชุฎุฏู ุนูุฏุฉ TPU - ูุฐุง ุณูุญุงูู ุดุฑุญ ููููุฉ ุงูุชุนุงูู ูุนูุง ุฅุฐุง ูุงู ุนููู ุฐูู! ุฑุงุฌุน [ุฏูุชุฑ ููุงุญุธุงุช ูุซุงู TPU](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/tpu_training-tf.ipynb) ููุญุตูู ุนูู ุฃูุซูุฉ ูู ุงูุฃููุงุฏ ุงูุชู ุชูุถุญ ุฐูู ุจูุฒูุฏ ูู ุงูุชูุตูู.

### ูุง ูู ุฃุญุฌุงู ูุญุฏุงุช TPU ุงููุชุงุญุฉุ

ุชุดุบู ูุญุฏุฉ TPU ูุงุญุฏุฉ (v2-8/v3-8/v4-8) 8 ูุณุฎ. ุชูุฌุฏ ูุญุฏุงุช TPU ูู **ูุฌููุนุงุช** ูููููุง ุชุดุบูู ูุฆุงุช ุฃู ุขูุงู ุงููุณุฎ ูู ููุช ูุงุญุฏ. ุนูุฏูุง ุชุณุชุฎุฏู ุฃูุซุฑ ูู ูุญุฏุฉ TPU ูุงุญุฏุฉ ูููู ุฃูู ูู ูุฌููุนุฉ ูุงููุฉ (ุนูู ุณุจูู ุงููุซุงูุ v3-32)ุ ูุดุงุฑ ุฅูู ุฃุณุทูู ูุญุฏุฉ TPU ุงูุฎุงุตุฉ ุจู ุจุงุณู **ุดุฑูุญุฉ ุงููุฌููุนุฉ**.

ุนูุฏูุง ุชููู ุจุงููุตูู ุฅูู ูุญุฏุฉ TPU ูุฌุงููุฉ ุนุจุฑ Colabุ ุชุญุตู ุจุดูู ุนุงู ุนูู ูุญุฏุฉ TPU ูุงุญุฏุฉ ูู ููุน v2-8.

### ูุง ุงูููุตูุฏ ุจู XLA ูููู ุชุฑุชุจุท ุจูุญุฏุงุช TPUุ

XLA ุนุจุงุฑุฉ ุนู ูุชุฑุฌู ููุญุณูููุ ูุณุชุฎุฏูู ูู ูู TensorFlow ูJAX. ูู JAXุ ูุนุฏ XLA ูู ุงููุชุฑุฌู ุงููุญูุฏุ ุจูููุง ูู TensorFlow ููู ุงุฎุชูุงุฑู (ูููู ุฅูุฒุงูู ุนูู ูุญุฏุฉ TPU!). ุฃุณูู ุทุฑููุฉ ูุชููููู ุนูุฏ ุชุฏุฑูุจ ูููุฐุฌ Keras ูู ุชูุฑูุฑ ุงูุญุฌุฉ `jit_compile=True` ุฅูู `model.compile()`. ุฅุฐุง ูู ุชุญุตู ุนูู ุฃู ุฃุฎุทุงุก ููุงู ุงูุฃุฏุงุก ุฌูุฏูุงุ ููุฐู ุนูุงูุฉ ุฑุงุฆุนุฉ ุนูู ุฃูู ูุณุชุนุฏ ููุงูุชูุงู ุฅูู ูุญุฏุฉ TPU!

ุบุงูุจูุง ูุง ูููู ุงูุชุตุญูุญ ุนูู ูุญุฏุฉ TPU ุฃูุซุฑ ุตุนูุจุฉ ููู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ/ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (CPU/GPU)ุ ูุฐุง ููุตู ุจุชุดุบูู ููุฏู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ/ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (CPU/GPU) ูุน XLA ุฃููุงู ูุจู ุชุฌุฑุจุชู ุนูู ูุญุฏุฉ TPU. ุจุงูุทุจุนุ ูุง ููุฒูู ุงูุชุฏุฑูุจ ููุชุฑุฉ ุทูููุฉ - ููุท ูุฎุทูุงุช ููููุฉ ููุชุฃูุฏ ูู ุฃู ูููุฐุฌู ูุฎุท ุฃูุงุจูุจ ุจูุงูุงุชู ูุนููุงู ููุง ุชุชููุน.

<Tip>

ุนุงุฏุฉู ูุง ูููู ุงูููุฏ ุงููุชุฑุฌู ุจูุงุณุทุฉ XLA ุฃุณุฑุน - ูุฐุง ุญุชู ุฅุฐุง ูู ุชูู ุชุฎุทุท ูุชุดุบููู ุนูู ูุญุฏุฉ TPUุ ูุฅู ุฅุถุงูุฉ `jit_compile=True` ูููู ุฃู ูุญุณู ุฃุฏุงุกู. ุชุฃูุฏ ูู ููุงุญุธุฉ ุงูุชุญุฐูุฑุงุช ุฃุฏูุงู ุญูู ุชูุงูู XLAุ ุนูู ุงูุฑุบู ูู ุฐูู!

</Tip>

<Tip warning={true}>

**ูุตูุญุฉ ูู ุชุฌุฑุจุฉ ูุคููุฉ:** ุนูู ุงูุฑุบู ูู ุฃู ุงุณุชุฎุฏุงู `jit_compile=True` ุทุฑููุฉ ุฌูุฏุฉ ููุญุตูู ุนูู ุฒูุงุฏุฉ ูู ุงูุณุฑุนุฉ ูุงุฎุชุจุงุฑ ูุง ุฅุฐุง ูุงู ููุฏ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ/ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (CPU/GPU) ูุชูุงูููุง ูุน XLAุ ุฅูุง ุฃูู ูููู ุฃู ูุณุจุจ ุงููุซูุฑ ูู ุงููุดููุงุช ุฅุฐุง ุชุฑูุชู ุนูุฏ ุงูุชุฏุฑูุจ ุงููุนูู ุนูู ูุญุฏุฉ TPU. ุณูุญุฏุซ ุงูุชุฌููุน ุจูุงุณุทุฉ XLA ุถููููุง ุนูู ูุญุฏุฉ TPUุ ูุฐุง ุชุฐูุฑ ุฅุฒุงูุฉ ูุฐุง ุงูุณุทุฑ ูุจู ุชุดุบูู ููุฏู ุจุงููุนู ุนูู ูุญุฏุฉ TPU!

</Tip>

### ููู ุฃุฌุนู ูููุฐุฌู ูุชูุงูููุง ูุน XLAุ

ูู ุงูุนุฏูุฏ ูู ุงูุญุงูุงุชุ ูู ุงููุญุชูู ุฃู ูููู ููุฏู ูุชูุงูููุง ุจุงููุนู ูุน XLA! ููุน ุฐููุ ููุงู ุจุนุถ ุงูุฃุดูุงุก ุงูุชู ุชุนูู ูู TensorFlow ุงูุนุงุฏู ูุงูุชู ูุง ุชุนูู ูู XLA. ููุฏ ูููุง ุจุชูุฎูุตูุง ูู ุซูุงุซ ููุงุนุฏ ุฃุณุงุณูุฉ ุฃุฏูุงู:

<Tip>

**๐คูุตูุญุฉ ุฎุงุตุฉ ุจู HuggingFace๐ค:** ููุฏ ุจุฐููุง ุงููุซูุฑ ูู ุงูุฌูุฏ ูู ุฅุนุงุฏุฉ ูุชุงุจุฉ ููุงุฐุฌ TensorFlow ููุธุงุฆู ุงูุฎุณุงุฑุฉ ุงูุฎุงุตุฉ ุจูุง ูุชููู ูุชูุงููุฉ ูุน XLA. ููุงุฐุฌูุง ููุธุงุฆู ุงูุฎุณุงุฑุฉ ูุฏููุง ุชูุชุฒู ุจุดูู ุนุงู ุจุงููุงุนุฏุชูู #1 ู#2 ุจุดูู ุงูุชุฑุงุถูุ ูุฐุง ููููู ุชุฎุทููุง ุฅุฐุง ููุช ุชุณุชุฎุฏู ููุงุฐุฌ `transformers`. ููู ูุง ุชูุณู ูุฐู ุงูููุงุนุฏ ุนูุฏ ูุชุงุจุฉ ููุงุฐุฌู ููุธุงุฆู ุงูุฎุณุงุฑุฉ ุงูุฎุงุตุฉ ุจู!

</Tip>

#### ูุงุนุฏุฉ XLA ุฑูู 1: ูุง ูููู ุฃู ูุญุชูู ููุฏู ุนูู "ุดุฑูุท ุชุนุชูุฏ ุนูู ุงูุจูุงูุงุช"

ูุง ูุนููู ุฐูู ูู ุฃูู ูุง ูููู ูุฃู ุนุจุงุฑุฉ `if` ุฃู ุชุนุชูุฏ ุนูู ุงูููู ุงูููุฌูุฏุฉ ุฏุงุฎู `tf.Tensor`. ุนูู ุณุจูู ุงููุซุงูุ ูุง ูููู ุชุฌููุน ูุชูุฉ ุงูููุฏ ูุฐู ุจุงุณุชุฎุฏุงู XLA!

```python
if tf.reduce_sum(tensor) > 10:
    tensor = tensor / 2.0
```

ูุฏ ูุจุฏู ูุฐุง ุชูููุฏูุง ุตุงุฑููุง ูู ุงูุจุฏุงูุฉุ ูููู ูุนุธู ุฃููุงุฏ ุงูุดุจูุงุช ุงูุนุตุจูุฉ ูุง ุชุญุชุงุฌ ุฅูู ุงูููุงู ุจุฐูู. ููููู ุบุงูุจูุง ุงูุงูุชูุงู ุญูู ูุฐุง ุงูุชูููุฏ ุจุงุณุชุฎุฏุงู `tf.cond` (ุฑุงุฌุน ุงููุซุงุฆู [ููุง](https://www.tensorflow.org/api_docs/python/tf/cond)) ุฃู ุนู ุทุฑูู ุฅุฒุงูุฉ ุงูุดุฑุท ูุฅูุฌุงุฏ ุฎุฏุนุฉ ุฑูุงุถูุฉ ุฐููุฉ ุจุงุณุชุฎุฏุงู ูุชุบูุฑุงุช ุงููุคุดุฑ ุจุฏูุงู ูู ุฐููุ ูุซู ูุง ููู:

```python
sum_over_10 = tf.cast(tf.reduce_sum(tensor) > 10, tf.float32)
tensor = tensor / (1.0 + sum_over_10)
```
```python
sum_over_10 = tf.cast(tf.reduce_sum(tensor) > 10, tf.float32)
tensor = tensor / (1.0 + sum_over_10)
```

ููุฐุง ุงูููุฏ ููุณ ุงูุชุฃุซูุฑ ุชูุงููุง ูุซู ุงูููุฏ ุฃุนูุงูุ ูููู ุนู ุทุฑูู ุชุฌูุจ ุงูุดุฑุทุ ูุถูู ุฃูู ุณูุชู ุชุฌููุนู ุจูุงุณุทุฉ XLA ุฏูู ูุดุงูู!

#### ูุงุนุฏุฉ XLA ุฑูู 2: ูุง ูููู ุฃู ูุญุชูู ููุฏู ุนูู "ุฃุดูุงู ุชุนุชูุฏ ุนูู ุงูุจูุงูุงุช"

ูุง ูุนููู ุฐูู ูู ุฃู ุดูู ุฌููุน ูุงุฆูุงุช `tf.Tensor` ูู ููุฏู ูุง ูููู ุฃู ูุนุชูุฏ ุนูู ููููุง. ุนูู ุณุจูู ุงููุซุงูุ ูุง ูููู ุชุฌููุน ุงูุฏุงูุฉ `tf.unique` ุจุงุณุชุฎุฏุงู XLAุ ูุฃููุง ุชุนูุฏ `tensor` ูุญุชูู ุนูู ูุซูู ูุงุญุฏ ูู ูู ูููุฉ ูุฑูุฏุฉ ูู ุงูุฅุฏุฎุงู. ุณูููู ุดูู ูุฐุง ุงูุฅุฎุฑุงุฌ ูุฎุชูููุง ุจูุถูุญ ุงุนุชูุงุฏูุง ุนูู ูุฏู ุชูุฑุงุฑ ุงูุฅุฏุฎุงู `Tensor`ุ ูุฐุง ูุฑูุถ XLA ุงูุชุนุงูู ูุนู!

ุจุดูู ุนุงูุ ุชูุชุฒู ูุนุธู ุฃููุงุฏ ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุจุงููุงุนุฏุฉ #2 ุจุดูู ุงูุชุฑุงุถู. ููุน ุฐููุ ููุงู ุจุนุถ ุงูุญุงูุงุช ุงูุดุงุฆุนุฉ ุงูุชู ุชุตุจุญ ูููุง ูุดููุฉ. ุฃุญุฏ ุงูุฃูุซูุฉ ุงูุดุงุฆุนุฉ ุฌุฏูุง ูู ุนูุฏูุง ุชุณุชุฎุฏู **ููุงุน ุงูุชุณููุฉ**ุ ุนู ุทุฑูู ุถุจุท ุชุณููุงุชู ุนูู ูููุฉ ุณุงูุจุฉ ููุฅุดุงุฑุฉ ุฅูู ุฃูู ูุฌุจ ุชุฌุงูู ูุฐู ุงูููุงุถุน ุนูุฏ ุญุณุงุจ ุงูุฎุณุงุฑุฉ. ุฅุฐุง ูุธุฑุช ุฅูู ูุธุงุฆู ุงูุฎุณุงุฑุฉ ูู NumPy ุฃู PyTorch ุงูุชู ุชุฏุนู ููุงุน ุงูุชุณููุฉุ ูุณุชุดุงูุฏ ุบุงูุจูุง ููุฏูุง ูุซู ูุฐุง ูุณุชุฎุฏู [ุงูููุฑุณุฉ ุงูุจูููุงููุฉ](https://numpy.org/doc/stable/user/basics.indexing.html#boolean-array-indexing):

```python
label_mask = labels >= 0
masked_outputs = outputs[label_mask]
masked_labels = labels[label_mask]
loss = compute_loss(masked_outputs, masked_labels)
mean_loss = torch.mean(loss)
```

ูุฐุง ุงูููุฏ ููุจูู ุชูุงููุง ูู NumPy ุฃู PyTorchุ ููููู ูุนุทูุจ ูู XLA! ููุงุฐุงุ ูุฃู ุดูู `masked_outputs` ู`masked_labels` ูุนุชูุฏ ุนูู ุนุฏุฏ ุงูููุงุถุน ุงููููุนุฉ - ููุง ูุฌุนููุง **ุดูููุง ูุนุชูุฏ ุนูู ุงูุจูุงูุงุช**. ููุน ุฐููุ ุชูุงููุง ูุซู ุงููุงุนุฏุฉ #1ุ ูููููุง ุบุงูุจูุง ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุฐุง ุงูููุฏ ูุฅูุชุงุฌ ููุณ ุงูุฅุฎุฑุงุฌ ุชูุงููุง ุฏูู ุฃู ุฃุดูุงู ุชุนุชูุฏ ุนูู ุงูุจูุงูุงุช.

```python
label_mask = tf.cast(labels >= 0, tf.float32)
loss = compute_loss(outputs, labels)
loss = loss * label_mask  # Set negative label positions to 0
mean_loss = tf.reduce_sum(loss) / tf.reduce_sum(label_mask)
```

ููุงุ ูุชุฌูุจ ุงูุฃุดูุงู ุงูุชู ุชุนุชูุฏ ุนูู ุงูุจูุงูุงุช ุนู ุทุฑูู ุญุณุงุจ ุงูุฎุณุงุฑุฉ ููู ููุถุนุ ูููู ูููู ุจุฅูุบุงุก ุชุญุฏูุฏ ุงูููุงุถุน ุงููููุนุฉ ูู ูู ูู ุงูุจุณุท ูุงูููุงู ุนูุฏ ุญุณุงุจ ุงููุชูุณุทุ ููุง ููุชุฌ ุนูู ููุณ ุงููุชูุฌุฉ ูุซู ูุชูุฉ ุงูููุฏ ุงูุฃููู ูุน ุงูุญูุงุธ ุนูู ุงูุชูุงูู ูุน XLA. ูุงุญุธ ุฃููุง ูุณุชุฎุฏู ููุณ ุงูุญููุฉ ููุง ูู ุงููุงุนุฏุฉ #1 - ุชุญููู `tf.bool` ุฅูู `tf.float32` ูุงุณุชุฎุฏุงูู ููุชุบูุฑ ูุคุดุฑ. ูุฐู ุญููุฉ ูููุฏุฉ ุญููุงุ ูุฐุง ุชุฐูุฑูุง ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชุญููู ููุฏู ุงูุฎุงุต ุฅูู XLA!

#### ูุงุนุฏุฉ XLA ุฑูู 3: ุณูุชุนูู ุนูู XLA ุฅุนุงุฏุฉ ุชุฌููุน ูููุฐุฌู ููู ุดูู ุฅุฏุฎุงู ูุฎุชูู ูุฑุงู

ูุฐู ูู ุงููุงุนุฏุฉ ุงููุจูุฑุฉ. ูุง ูุนููู ุฐูู ูู ุฃูู ุฅุฐุง ูุงูุช ุฃุดูุงู ุงูุฅุฏุฎุงู ูุฏูู ูุชุบูุฑุฉ ุฌุฏูุงุ ูุณูุชุนูู ุนูู XLA ุฅุนุงุฏุฉ ุชุฌููุน ูููุฐุฌู ูุฑุงุฑูุง ูุชูุฑุงุฑูุงุ ููุง ุณูุฎูู ูุดููุงุช ูุจูุฑุฉ ูู ุงูุฃุฏุงุก. ุบุงูุจูุง ูุง ููุดุฃ ูุฐุง ูู ููุงุฐุฌ ูุนุงูุฌุฉ ุงููุบุงุช ุงูุทุจูุนูุฉุ ุญูุซ ุชููู ูุตูุต ุงูุฅุฏุฎุงู ุฐุงุช ุฃุทูุงู ูุชุบูุฑุฉ ุจุนุฏ ุงูุชูููุฒ. ูู ุงูุทุฑุงุฆู ุงูุฃุฎุฑูุ ุชููู ุงูุฃุดูุงู ุงูุซุงุจุชุฉ ุฃูุซุฑ ุดููุนูุง ููุฐู ุงููุงุนุฏุฉ ุฃูู ุฅุดูุงููุฉ.

ููู ููููู ุงูุงูุชูุงู ุญูู ุงููุงุนุฏุฉ #3ุ ุงูููุชุงุญ ูู **ุงูุชูุณูู** - ุฅุฐุง ููุช ุจุชูุณูู ุฌููุน ุฅุฏุฎุงูุงุชู ุฅูู ููุณ ุงูุทููุ ุซู ุงุณุชุฎุฏูุช `attention_mask`ุ ูููููู ุงูุญุตูู ุนูู ููุณ ุงููุชุงุฆุฌ ููุง ูู ููุช ุชุณุชุฎุฏู ุฃุดูุงููุง ูุชุบูุฑุฉุ ูููู ุฏูู ุฃู ูุดููุงุช ูู XLA. ููุน ุฐููุ ูููู ุฃู ูุชุณุจุจ ุงูุชูุณูู ุงูููุฑุท ูู ุญุฏูุซ ุชุจุงุทุค ุดุฏูุฏ ุฃูุถูุง - ุฅุฐุง ููุช ุจุชูุณูู ุฌููุน ุนููุงุชู ุฅูู ุงูุทูู ุงูุฃูุตู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุงุ ููุฏ ููุชูู ุจู ุงูุฃูุฑ ุจูุฌููุนุงุช ุชุชููู ูู ุฑููุฒ ุงูุชูุณูู ุงูุชู ูุง ููุงูุฉ ููุงุ ูุงูุชู ุณุชุณุชููู ุงููุซูุฑ ูู ุงูุทุงูุฉ ุงูุญุงุณูุจูุฉ ูุงูุฐุงูุฑุฉ!

ูุง ููุฌุฏ ุญู ูุซุงูู ููุฐู ุงููุดููุฉ. ููุน ุฐููุ ููููู ุชุฌุฑุจุฉ ุจุนุถ ุงูุญูู. ุฅุญุฏู ุงูุญูู ุงููููุฏุฉ ููุบุงูุฉ ูู **ุชูุณูู ูุฌููุนุงุช ุงูุนููุงุช ุฅูู ูุถุงุนูุงุช ูุนุฏุฏ ูุซู 32 ุฃู 64 ุฑูุฒูุง**. ุบุงูุจูุง ูุง ูุฒูุฏ ูุฐุง ูู ุนุฏุฏ ุงูุฑููุฒ ููููุงูุ ููููู ูููู ุจุดูู ูุจูุฑ ูู ุนุฏุฏ ุงูุฃุดูุงู ุงููุฑูุฏุฉ ููุฅุฏุฎุงูุ ูุฃู ูู ุดูู ุฅุฏุฎุงู ูุฌุจ ุฃู ูููู ุงูุขู ูุถุงุนููุง ูู 32 ุฃู 64. ุนุฏุฏ ุฃูู ูู ุงูุฃุดูุงู ุงููุฑูุฏุฉ ููุฅุฏุฎุงู ูุนูู ุนุฏุฏ ุฃูู ูู ุนูููุงุช ุงูุชุฌููุน ุจูุงุณุทุฉ XLA!

<Tip>
<Tip>

**๐คูุตูุญุฉ ุฎุงุตุฉ ุจู HuggingFace๐ค:** ุชุญุชูู ุทุฑู ุงูุชูููุฒ ููุฌูุนุงุช ุงูุจูุงูุงุช ูุฏููุง ุนูู ุทุฑู ูููู ุฃู ุชุณุงุนุฏู ููุง. ููููู ุงุณุชุฎุฏุงู `padding="max_length"` ุฃู `padding="longest"` ุนูุฏ ุงุณุชุฏุนุงุก ุทุฑู ุงูุชูููุฒ ููุญุตูู ุนูู ุจูุงูุงุช ููุณูุฉ. ุชุญุชูู ุทุฑู ุงูุชูููุฒ ููุฌูุนุงุช ุงูุจูุงูุงุช ูุฏููุง ุฃูุถูุง ุนูู ุญุฌุฉ `pad_to_multiple_of` ุงูุชู ููููู ุงุณุชุฎุฏุงููุง ูุชูููู ุนุฏุฏ ุงูุฃุดูุงู ุงููุฑูุฏุฉ ููุฅุฏุฎุงู ุงูุชู ุชุดุงูุฏูุง!

</Tip>

### ููู ุฃููู ุจุชุฏุฑูุจ ูููุฐุฌู ุจุงููุนู ุนูู ูุญุฏุฉ TPUุ

ุจูุฌุฑุฏ ุฃู ูุตุจุญ ุชุฏุฑูุจู ูุชูุงูููุง ูุน XLA (ูุฅุฐุง ููุช ุชุณุชุฎุฏู ุนูุฏุฉ TPU / Colab) ูุชู ุฅุนุฏุงุฏ ูุฌููุนุฉ ุจูุงูุงุชู ุจุดูู ููุงุณุจุ ูุฅู ุงูุชุดุบูู ุนูู ูุญุฏุฉ TPU ูููู ุณููุงู ุจุดูู ูุฏูุด! ูู ูุง ุชุญุชุงุฌ ุฅูู ุชุบููุฑู ุญููุง ูู ููุฏู ูู ุฅุถุงูุฉ ุจุถุน ุฃุณุทุฑ ูุชููุฆุฉ ูุญุฏุฉ TPU ุงูุฎุงุตุฉ ุจูุ ูุงูุชุฃูุฏ ูู ุฅูุดุงุก ูููุฐุฌู ููุฌููุนุฉ ุจูุงูุงุชู ุฏุงุฎู ูุทุงู `TPUStrategy`. ุงูู ูุธุฑุฉ ุนูู [ุฏูุชุฑ ููุงุญุธุงุช ูุซุงู TPU](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/tpu_training-tf.ipynb) ููุดุงูุฏุฉ ุฐูู ูู ุงููุงูุน!

### ุงูุฎูุงุตุฉ

ูุงู ููุงู ุงููุซูุฑ ููุงุ ูุฐุง ุฏุนููุง ููุฎุต ุจูุงุฆูุฉ ูุฑุงุฌุนุฉ ุณุฑูุนุฉ ููููู ุงุชุจุงุนูุง ุนูุฏูุง ุชุฑูุฏ ุฅุนุฏุงุฏ ูููุฐุฌู ููุชุฏุฑูุจ ุนูู TPU:

- ุชุฃูุฏ ูู ุงุชุจุงุน ุชุนูููุงุชู ูููุงุนุฏ XLA ุงูุซูุงุซุฉ
- ูู ุจุชุฌููุน ูููุฐุฌู ุจุงุณุชุฎุฏุงู `jit_compile=True` ุนูู CPU/GPU ูุชุฃูุฏ ูู ุฃูู ููููู ุชุฏุฑูุจู ุจุงุณุชุฎุฏุงู XLA
- ุฅูุง ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู ูู ุงูุฐุงูุฑุฉ ุฃู ุงุณุชุฎุฏุงู ููุฌ ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุชูุงูู ูุน TPU (ุฑุงุฌุน [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/tpu_training-tf.ipynb))
- ูู ุจุชุฑุญูู ุชุนูููุงุชู ุงูุจุฑูุฌูุฉ ุฅูุง ุฅูู Colab (ูุน ุชุนููู ุงููุนุฌู ุฅูู "TPU") ุฃู ุฌูุงุฒ ุธุงูุฑู TPU ุนูู Google Cloud
- ุฅุถุงูุฉ ุฑูุฒ ุจุงุฏุฆ TPU (ุฑุงุฌุน [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/tpu_training-tf.ipynb))
- ุฅูุดุงุก `TPUStrategy` ุงูุฎุงุต ุจู ูุงูุชุฃูุฏ ูู ุฃู ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุฅูุดุงุก ุงููููุฐุฌ ุฏุงุฎู `strategy.scope()` (ุฑุงุฌุน [ุฏูุชุฑ ุงูููุงุญุธุงุช](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/tpu_training-tf.ipynb))
- ูุง ุชูุณ ุฃู ุชุฃุฎุฐ `jit_compile=True` ูุฑุฉ ุฃุฎุฑู ุนูุฏูุง ุชูุชูู ุฅูู TPU!
- ๐๐๐๐ฅบ๐ฅบ๐ฅบ
- ุงุณุชุฏุนุงุก model.fit()
- ููุฏ ูุนูุช ุฐูู!