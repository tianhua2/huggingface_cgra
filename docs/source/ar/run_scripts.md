# ุงูุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู ูุต ุจุฑูุฌู

ุจุงูุฅุถุงูุฉ ุฅูู ุฏูุงุชุฑ ุงูููุงุญุธุงุช [notebooks](./notebooks) ุงูุฎุงุตุฉ ุจู ๐ค Transformersุ ููุงู ุฃูุถูุง ูุตูุต ุจุฑูุฌูุฉ ุชูุถูุญูุฉ ุชูุธูุฑ ููููุฉ ุชุฏุฑูุจ ูููุฐุฌ ููููุฉ ุจุงุณุชุฎุฏุงู [PyTorch](https://github.com/huggingface/transformers/tree/main/examples/pytorch) ุฃู [TensorFlow](https://github.com/huggingface/transformers/tree/main/examples/tensorflow) ุฃู [JAX/Flax](https://github.com/huggingface/transformers/tree/main/examples/flax).

ููุง ุณุชุฌุฏ ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงูุชู ุงุณุชุฎุฏููุงูุง ูู [ูุดุงุฑูุน ุงูุฃุจุญุงุซ](https://github.com/huggingface/transformers/tree/main/examples/research_projects) ู [ุงูุฃูุซูุฉ ุงููุฏููุฉ](https://github.com/huggingface/transformers/tree/main/examples/legacy) ูุงูุชู ุณุงูู ุจูุง ุงููุฌุชูุน ุจุดูู ุฃุณุงุณู. ูุฐู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุบูุฑ ูุฏุนููุฉ ุจุดูู ูุดุท ููุฏ ุชุชุทูุจ ุฅุตุฏุงุฑูุง ูุญุฏุฏูุง ูู ููุชุจุฉ ๐ค Transformers ูุงูุฐู ูู ุงููุญุชูู ุฃู ูููู ุบูุฑ ูุชูุงูู ูุน ุงูุฅุตุฏุงุฑ ุงูุฃุญุฏุซ ูู ุงูููุชุจุฉ.

ูุง ููุชููุน ุฃู ุชุนูู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงูุชูุถูุญูุฉ ุจุดูู ูุจุงุดุฑ ุนูู ูู ูุดููุฉุ ููุฏ ุชุญุชุงุฌ ุฅูู ุชูููู ุงููุต ุงูุจุฑูุฌู ูุน ุงููุดููุฉ ุงูุชู ุชุญุงูู ุญููุง. ูููุณุงุนุฏุชู ูู ุฐููุ ุชุนุฑุถ ูุนุธู ุงููุตูุต ุงูุจุฑูุฌูุฉ ููููุฉ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุจู ุงูุชุฏุฑูุจ ุจุดูู ูุงููุ ููุง ูุชูุญ ูู ุชุญุฑูุฑูุง ุญุณุจ ุงูุญุงุฌุฉ ูุญุงูุชู ุงูุงุณุชุฎุฏุงู.

ุจุงููุณุจุฉ ูุฃู ููุฒุฉ ุชุฑุบุจ ูู ุชูููุฐูุง ูู ูุต ุจุฑูุฌู ุชูุถูุญูุ ูุฑุฌู ููุงูุดุชูุง ูู [ุงูููุชุฏู](https://discuss.huggingface.co/) ุฃู ูู [ูุถูุฉ](https://github.com/huggingface/transformers/issues) ูุจู ุฅุฑุณุงู ุทูุจ ุณุญุจ. ููู ุญูู ุฃููุง ูุฑุญุจ ุจุฅุตูุงุญ ุงูุฃุฎุทุงุกุ ููู ุบูุฑ ุงููุฑุฌุญ ุฃู ูููู ุจุฏูุฌ ุทูุจ ุณุญุจ ุงูุฐู ูุถูู ุงููุฒูุฏ ูู ุงููุธุงุฆู ุนูู ุญุณุงุจ ูุงุจููุฉ ุงููุฑุงุกุฉ.

ุณููุถุญ ูุฐุง ุงูุฏููู ููููุฉ ุชุดุบูู ูุต ุจุฑูุฌู ุชูุถูุญู ููุชุฏุฑูุจ ุนูู ุงูุชูุฎูุต ูู [PyTorch](https://github.com/huggingface/transformers/tree/main/examples/pytorch/summarization) ู [TensorFlow](https://github.com/huggingface/transformers/tree/main/examples/tensorflow/summarization). ููุชููุน ุฃู ุชุนูู ุฌููุน ุงูุฃูุซูุฉ ูุน ููุง ุงูุฅุทุงุฑูู ูุง ูู ูููุต ุนูู ุฎูุงู ุฐูู.

## ุงูุฅุนุฏุงุฏ

ูุชุดุบูู ุงูุฅุตุฏุงุฑ ุงูุฃุญุฏุซ ูู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงูุชูุถูุญูุฉ ุจูุฌุงุญุ ูุฌุจ ุนููู **ุชุซุจูุช ๐ค Transformers ูู ุงููุตุฏุฑ** ูู ุจูุฆุฉ ุงูุชุฑุงุถูุฉ ุฌุฏูุฏุฉ:

```bash
git clone https://github.com/huggingface/transformers
cd transformers
pip install .
```

ุจุงููุณุจุฉ ููุฅุตุฏุงุฑุงุช ุงูุฃูุฏู ูู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงูุชูุถูุญูุฉุ ุงููุฑ ููู ุงูุฒุฑ ุฃุฏูุงู:
```bash
git clone https://github.com/huggingface/transformers
cd transformers
pip install .
```

ุจุงููุณุจุฉ ููุฅุตุฏุงุฑุงุช ุงูุฃูุฏู ูู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงูุชูุถูุญูุฉุ ุงููุฑ ููู ุงูุฒุฑ ุฃุฏูุงู:

<details>
  <summary>ุฃูุซูุฉ ููุฅุตุฏุงุฑุงุช ุงูุฃูุฏู ูู ๐ค Transformers</summary>
	<ul>
		<li><a href="https://github.com/huggingface/transformers/tree/v4.5.1/examples">v4.5.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v4.4.2/examples">v4.4.2</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v4.3.3/examples">v4.3.3</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v4.2.2/examples">v4.2.2</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v4.1.1/examples">v4.1.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v4.0.1/examples">v4.0.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v3.5.1/examples">v3.5.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v3.4.0/examples">v3.4.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v3.3.1/examples">v3.3.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v3.2.0/examples">v3.2.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v3.1.0/examples">v3.1.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v3.0.2/examples">v3.0.2</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.11.0/examples">v2.11.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.10.0/examples">v2.10.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.9.1/examples">v2.9.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.8.0/examples">v2.8.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.7.0/examples">v2.7.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.6.0/examples">v2.6.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.5.1/examples">v2.5.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.4.0/examples">v2.4.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.3.0/examples">v2.3.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.2.0/examples">v2.2.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.1.0/examples">v2.1.1</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v2.0.0/examples">v2.0.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v1.2.0/examples">v1.2.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v1.1.0/examples">v1.1.0</a></li>
		<li><a href="https://github.com/huggingface/transformers/tree/v1.0.0/examples">v1.0.0</a></li>
	</ul>
</details>

ุซู ูู ุจุงูุชุจุฏูู ุฅูู ุงููุณุฎุฉ ุงูุญุงููุฉ ูู ๐ค Transformers ุฅูู ุฅุตุฏุงุฑ ูุญุฏุฏุ ูุซู v3.5.1 ุนูู ุณุจูู ุงููุซุงู:

```bash
git checkout tags/v3.5.1
```

ุจุนุฏ ุฅุนุฏุงุฏ ุฅุตุฏุงุฑ ุงูููุชุจุฉ ุงูุตุญูุญุ ุงูุชูู ุฅูู ูุฌูุฏ ุงูุฃูุซูุฉ ุงูุฐู ุชุฎุชุงุฑู ููู ุจุชุซุจูุช ุงููุชุทูุจุงุช ุงููุญุฏุฏุฉ:

```bash
pip install -r requirements.txt
```

## ุชุดุบูู ูุต ุจุฑูุฌู

<frameworkcontent>
<pt>
    
- ูููู ุงููุต ุงูุจุฑูุฌู ุงูุชูุถูุญู ุจุชูุฒูู ูุฌููุนุฉ ุจูุงูุงุช ููุนุงูุฌุชูุง ูุณุจููุง ูู ููุชุจุฉ ๐ค [Datasets](https://huggingface.co/docs/datasets).
- ุซู ูููู ุงููุต ุงูุจุฑูุฌู ุจุถุจุท ูููุฐุฌ ุจูุงูุงุช ุฏููู ุจุงุณุชุฎุฏุงู [Trainer](https://huggingface.co/docs/transformers/main_classes/trainer) ุนูู ุจููุฉ ุชุฏุนู ุงูููุฎุต. 
- ููุถุญ ุงููุซุงู ุงูุชุงูู ููููุฉ ุถุจุท ูููุฐุฌ [T5-small](https://huggingface.co/google-t5/t5-small) ุนูู ูุฌููุนุฉ ุจูุงูุงุช [CNN/DailyMail](https://huggingface.co/datasets/cnn_dailymail).
- ูุชุทูุจ ูููุฐุฌ T5 ูุนุงูู `source_prefix` ุฅุถุงููุฉ ุจุณุจุจ ุงูุทุฑููุฉ ุงูุชู ุชู ุชุฏุฑูุจู ุจูุง. ูุชูุญ ูุฐุง ุงููุทุงูุจุฉ ูู T5 ูุนุฑูุฉ ุฃู ูุฐู ูููุฉ ุงูุชูุฎูุต.
    
```bash
python examples/pytorch/summarization/run_summarization.py \
    --model_name_or_path google-t5/t5-small \
    --do_train \
    --do_eval \
    --dataset_name cnn_dailymail \
    --dataset_config "3.0.0" \
    --source_prefix "summarize: " \
    --output_dir /tmp/tst-summarization \
    --per_device_train_batch_size=4 \
    --per_device_eval_batch_size=4 \
    --overwrite_output_dir \
    --predict_with_generate
```
</pt>
<tf>
    
- ูููู ุงููุต ุงูุจุฑูุฌู ุงูุชูุถูุญู ุจุชูุฒูู ูุฌููุนุฉ ุจูุงูุงุช ููุนุงูุฌุชูุง ูุณุจููุง ูู ููุชุจุฉ ๐ค [Datasets](https://huggingface.co/docs/datasets/).
- ุซู ูููู ุงููุต ุงูุจุฑูุฌู ุจุถุจุท ูููุฐุฌ ุจูุงูุงุช ุฏููู ุจุงุณุชุฎุฏุงู Keras ุนูู ุจููุฉ ุชุฏุนู ุงูููุฎุต.
- ููุถุญ ุงููุซุงู ุงูุชุงูู ููููุฉ ุถุจุท ูููุฐุฌ [T5-small](https://huggingface.co/google-t5/t5-small) ุนูู ูุฌููุนุฉ ุจูุงูุงุช [CNN/DailyMail](https://huggingface.co/datasets/cnn_dailymail).
- ูุชุทูุจ ูููุฐุฌ T5 ูุงุนูู `source_prefix` ุฅุถุงููุฉ ุจุณุจุจ ุงูุทุฑููุฉ ุงูุชู ุชู ุชุฏุฑูุจู ุจูุง. ูุชูุญ ูุฐุง ุงููุทุงูุจุฉ ูู T5 ูุนุฑูุฉ ุฃู ูุฐู ูููุฉ ุงูุชูุฎูุต.

```bash
python examples/tensorflow/summarization/run_summarization.py  \
    --model_name_or_path google-t5/t5-small \
    --dataset_name cnn_dailymail \
    --dataset_config "3.0.0" \
    --output_dir /tmp/tst-summarization  \
    --per_device_train_batch_size 8 \
    --per_device_eval_batch_size 16 \
    --num_train_epochs 3 \
    --do_train \
    --do_eval
```
</tf>
</frameworkcontent>

## ุงูุชุฏุฑูุจ ุงูููุฒุน ูุงูุฏูุฉ ุงููุฎุชูุทุฉ

ูุฏุนู [Trainer](https://huggingface.co/docs/transformers/main_classes/trainer) ุงูุชุฏุฑูุจ ุงูููุฒุน ูุงูุฏูุฉ ุงููุฎุชูุทุฉุ ููุง ูุนูู ุฃูู ููููู ุฃูุถูุง ุงุณุชุฎุฏุงูู ูู ูุต ุจุฑูุฌู. ูุชูููู ููุชุง ุงูููุฒุชูู:

- ุฃุถู ูุนุงูู `fp16` ูุชูููู ุงูุฏูุฉ ุงููุฎุชูุทุฉ.
- ูู ุจุชุนููู ุนุฏุฏ ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPUs) ุงูุชู ุชุฑูุฏ ุงุณุชุฎุฏุงููุง ุจุงุณุชุฎุฏุงู ุญุฌุฉ `nproc_per_node`.

```bash
torchrun \
    --nproc_per_node 8 pytorch/summarization/run_summarization.py \
    --fp16 \
    --model_name_or_path google-t5/t5-small \
    --do_train \
    --do_eval \
    --dataset_name cnn_dailymail \
    --dataset_config "3.0.0" \
    --source_prefix "summarize: " \
    --output_dir /tmp/tst-summarization \
    --per_device_train_batch_size=4 \
    --per_device_eval_batch_size=4 \
    --overwrite_output_dir \
    --predict_with_generate
```

ุชุณุชุฎุฏู ูุตูุต TensorFlow ุงูุจุฑูุฌูุฉ ุงุณุชุฑุงุชูุฌูุฉ [`MirroredStrategy`](https://www.tensorflow.org/guide/distributed_training#mirroredstrategy) ููุชุฏุฑูุจ ุงูููุฒุนุ ููุง ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฃู ูุนุงู๏ปปุช ุฅุถุงููุฉ ุฅูู ุงููุต ุงูุจุฑูุฌู ุงูุชุฏุฑูุจู. ุณูุณุชุฎุฏู ูุต TensorFlow ุงูุจุฑูุฌู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPUs) ูุชุนุฏุฏุฉ ุจุดูู ุงูุชุฑุงุถู ุฅุฐุง ูุงูุช ูุชููุฑุฉ.

## ุชุดุบูู ูุต ุจุฑูุฌู ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPU)

<frameworkcontent>
<pt>
    
ุชูุนุฏ ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPUs) ูุตููุฉ ุฎุตูุตูุง ูุชุณุฑูุน ุงูุฃุฏุงุก. ูุฏุนู PyTorch ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPUs) ูุน [XLA](https://www.tensorflow.org/xla) ูุฌูุน ุงูุฏูุฉ ุงููุงุฆูุฉ ููุชุนูู ุงูุนููู (ุฑุงุฌุน [ููุง](https://github.com/pytorch/xla/blob/master/README.md) ููุฒูุฏ ูู ุงูุชูุงุตูู). ูุงุณุชุฎุฏุงู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPU)ุ ูู ุจุชุดุบูู ูุต `xla_spawn.py` ุงูุจุฑูุฌู ูุงุณุชุฎุฏู ูุนุงูู `num_cores` ูุชุนููู ุนุฏุฏ ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPU) ุงูุชู ุชุฑูุฏ ุงุณุชุฎุฏุงููุง.

```bash
python xla_spawn.py --num_cores 8 \
    summarization/run_summarization.py \
    --model_name_or_path google-t5/t5-small \
    --do_train \
    --do_eval \
    --dataset_name cnn_dailymail \
    --dataset_config "3.0.0" \
    --source_prefix "summarize: " \
    --output_dir /tmp/tst-summarization \
    --per_device_train_batch_size=4 \
    --per_device_eval_batch_size=4 \
    --overwrite_output_dir \
    --predict_with_generate
```
</pt>
<tf>
    
ุชูุนุฏ ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPUs) ูุตููุฉ ุฎุตูุตูุง ูุชุณุฑูุน ุงูุฃุฏุงุก. ุชุณุชุฎุฏู ูุตูุต TensorFlow ุงูุจุฑูุฌูุฉ ุงุณุชุฑุงุชูุฌูุฉ [`TPUStrategy`](https://www.tensorflow.org/guide/distributed_training#tpustrategy) ููุชุฏุฑูุจ ุนูู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPUs). ูุงุณุชุฎุฏุงู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPU)ุ ูู ุจุชูุฑูุฑ ุงุณู ููุฑุฏ ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPU) ุฅูู ุญุฌุฉ `tpu`.
```bash
python run_summarization.py  \
    --tpu name_of_tpu_resource \
    --model_name_or_path google-t5/t5-small \
    --dataset_name cnn_dailymail \
    --dataset_config "3.0.0" \
    --output_dir /tmp/tst-summarization  \
    --per_device_train_batch_size 8 \
    --per_device_eval_batch_size 16 \
    --num_train_epochs 3 \
    --do_train \
    --do_eval
```
</tf>
</frameworkcontent>

## ุชุดุบูู ูุต ุจุฑูุฌู ุจุงุณุชุฎุฏุงู ๐ค Accelerate

๐ค [Accelerate](https://huggingface.co/docs/accelerate) ูู ููุชุจุฉ ุฎุงุตุฉ ุจู PyTorch ููุท ุชููุฑ ุทุฑููุฉ ููุญุฏุฉ ูุชุฏุฑูุจ ูููุฐุฌ ุนูู ุนุฏุฉ ุฃููุงุน ูู ุงูุฅุนุฏุงุฏุงุช (ุงูุงุนุชูุงุฏ ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ (CPU) ููุทุ ุฃู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPUs) ุงููุชุนุฏุฏุฉุ ุฃู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฏูุฉ ุงููุงุฆูุฉ (TPUs)) ูุน ุงูุญูุงุธ ุนูู ุงูุฑุคูุฉ ุงููุงููุฉ ูุญููุฉ ุชุฏุฑูุจ PyTorch. ุชุฃูุฏ ูู ุชุซุจูุช ๐ค Accelerate ุฅุฐุง ูู ููู ูุฏูู ุจุงููุนู:

> ููุงุญุธุฉ: ูุธุฑูุง ูุฃู Accelerate ูู ุญุงูุฉ ุชุทููุฑ ุณุฑูุนุ ูุฌุจ ุชุซุจูุช ุฅุตุฏุงุฑ Git ูู Accelerate ูุชุดุบูู ุงููุตูุต ุงูุจุฑูุฌูุฉ.
```bash
pip install git+https://github.com/huggingface/accelerate
```

ุจุฏูุงู ูู ูุต `run_summarization.py` ุงูุจุฑูุฌูุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ูุต `run_summarization_no_trainer.py` ุงูุจุฑูุฌู. ุณุชููู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงููุฏุนููุฉ ูู ๐ค Accelerate ููุง ููู `task_no_trainer.py` ูู ุงููุฌูุฏ. ุงุจุฏุฃ ุจุชุดุบูู ุงูุฃูุฑ ุงูุชุงูู ูุฅูุดุงุก ูุญูุธ ููู ุชูููู:

```bash
accelerate config
```

ุงุฎุชุจุฑ ุฅุนุฏุงุฏู ููุชุฃูุฏ ูู ุฃูู ุชู ุชููููู ุจุดูู ุตุญูุญ:

```bash
accelerate test
```

ุงูุขู ุฃูุช ูุณุชุนุฏ ูุจุฏุก ุงูุชุฏุฑูุจ:

```bash
accelerate launch run_summarization_no_trainer.py \
    --model_name_or_path google-t5/t5-small \
    --dataset_name cnn